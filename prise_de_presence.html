
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Prise de présence</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h2 { text-align: center; }
        table { border-collapse: collapse; width: 100%; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 6px; text-align: center; }
        select, input[type="number"] { width: 100%; }
        .minutes-input { display: none; width: 60px; }
        .header-row { background-color: #f2f2f2; }
        .form-section { margin-bottom: 20px; }
    </style>
</head>
<body>
    <h2>Feuille de présence</h2>

    <div class="form-section">
        <label for="cohorte">Cohorte :</label>
        <select id="cohorte" onchange="loadEleves()">
            <option value="">-- Sélectionner une cohorte --</option>
            <option value="SASI-2025">SASI-2025</option>
            <option value="SASI-2026">SASI-2026</option>
            <option value="Électricité-2025">Électricité-2025</option>
        </select>

        <label for="date">Date :</label>
        <input type="date" id="date">
    </div>

    <table id="presenceTable">
        <thead>
            <tr class="header-row">
                <th>Nom de l'élève</th>
                <th>P1</th>
                <th>P2</th>
                <th>P3</th>
                <th>P4</th>
                <th>P5</th>
                <th>P6</th>
                <th>P7</th>
            </tr>
        </thead>
        <tbody id="tableBody">
            <!-- Les lignes des élèves seront insérées ici dynamiquement -->
        </tbody>
    </table>

    <div style="text-align: center; margin-top: 20px;">
        <button onclick="enregistrerPresences()">Enregistrer les présences</button>
    </div>

    <script>
        const elevesParCohorte = {
            "SASI-2025": ["Nadia Bouchard", "Olivier Martel"],
            "SASI-2026": ["Émilie Tremblay", "Marc Gagnon"],
            "Électricité-2025": ["Jean Fortin", "Lucie Moreau"]
        };

        const periodesParCohorte = {
            "SASI-2025": 6,
            "SASI-2026": 6,
            "Électricité-2025": 7
        };

        const statuts = [
            "Présent", "Libération", "Absence motivée", "Absence non motivée",
            "Retard", "Départ hâtif", "Rencontre SEC"
        ];

        function loadEleves() {
            const cohorte = document.getElementById("cohorte").value;
            const tableBody = document.getElementById("tableBody");
            tableBody.innerHTML = "";

            if (!cohorte || !elevesParCohorte[cohorte]) return;

            const eleves = elevesParCohorte[cohorte];
            const nbPeriodes = periodesParCohorte[cohorte];

            eleves.forEach(nom => {
                const row = document.createElement("tr");
                const nomCell = document.createElement("td");
                nomCell.textContent = nom;
                row.appendChild(nomCell);

                for (let i = 1; i <= 7; i++) {
                    const cell = document.createElement("td");
                    if (i <= nbPeriodes) {
                        const select = document.createElement("select");
                        select.name = `statut_${nom}_${i}`;
                        select.onchange = function () {
                            const input = this.nextSibling;
                            if (["Retard", "Départ hâtif", "Rencontre SEC"].includes(this.value)) {
                                input.style.display = "inline-block";
                            } else {
                                input.style.display = "none";
                                input.value = "";
                            }
                        };

                        statuts.forEach(s => {
                            const option = document.createElement("option");
                            option.value = s;
                            option.textContent = s;
                            select.appendChild(option);
                        });

                        const minutesInput = document.createElement("input");
                        minutesInput.type = "number";
                        minutesInput.min = "0";
                        minutesInput.placeholder = "min";
                        minutesInput.className = "minutes-input";

                        cell.appendChild(select);
                        cell.appendChild(minutesInput);
                    }
                    row.appendChild(cell);
                }

                tableBody.appendChild(row);
            });
        }

        function enregistrerPresences() {
            const date = document.getElementById("date").value;
            const cohorte = document.getElementById("cohorte").value;
            const table = document.getElementById("presenceTable");
            const rows = table.querySelectorAll("tbody tr");

            const donnees = [];

            rows.forEach(row => {
                const nom = row.cells[0].textContent;
                for (let i = 1; i < row.cells.length; i++) {
                    const cell = row.cells[i];
                    const select = cell.querySelector("select");
                    const minutes = cell.querySelector("input");

                    if (select) {
                        donnees.push({
                            nom: nom,
                            periode: i,
                            statut: select.value,
                            minutes: minutes && minutes.value ? parseInt(minutes.value) : 0,
                            date: date,
                            cohorte: cohorte
                        });
                    }
                }
            });

            console.log("Données à enregistrer :", donnees);
            alert("Simulation : les présences ont été enregistrées dans la console.");
        }
    </script>
</body>
</html>
